# ⚙️ Dict-I18n 配置说明文档

该文档详细介绍了 `dict-i18n` 所有可配置的 YAML 配置项，用于集成到 Spring Boot 项目的 `application.yml` 或
`application.properties` 中。

---

## 📌 顶层配置结构

```yaml
dict-i18n:
  loader-order:               # 加载器优先级顺序
  max-nesting-depth:          # 最大嵌套解析深度
  return-key-if-empty:        # 描述缺失时是否返回字典 key
  default-lang:               # 默认语言
  loader:                     # 各加载器配置
  starter:                    # 启动相关配置
```

---

## 🔄 `loader-order` — 加载器优先级

**类型**：`List<String>`
**说明**：指定字典加载器的加载顺序，先加载的优先级高。
**示例**：

```yaml
loader-order:
  - redis
  - sql
  - file
  - declared
```

---

## 🔍 `max-nesting-depth` — 最大嵌套解析深度

**类型**：`int`
**默认值**：`10`
**说明**：解析对象中嵌套字典字段的最大递归层级，防止死循环。

---

## 🔁 `return-key-if-empty` — 返回字典 key（当描述为空）

**类型**：`boolean`
**默认值**：`true`
**说明**：如果找不到翻译描述，是否返回字典 key 本身作为兜底内容。

---

## 🌐 `default-lang` — 默认语言

**类型**：`String`
**默认值**：`""`
**说明**：当请求语言找不到对应翻译时使用的默认语言。默认值对应的文件为`dict.yml`。

---

## 🧩 `loader` — 各加载器配置

支持的加载器包括：`declared`（代码声明）、`file`（文件）、`sql`（数据库）、`redis`（缓存）

---

### 1️⃣ `declared` — 基于代码声明的加载器

| 配置项             | 类型           | 默认值    | 说明              |
|-----------------|--------------|--------|-----------------|
| `enabled`       | boolean      | `true` | 是否启用该加载器        |
| `ignore-case`   | boolean      | `true` | 是否忽略字典 key 的大小写 |
| `scan-packages` | List<String> | `[]`   | 扫描基础路径          |

---

### 2️⃣ `file` — 基于资源文件的加载器

| 配置项                 | 类型           | 默认值                                                                                                          | 说明              |
|---------------------|--------------|--------------------------------------------------------------------------------------------------------------|-----------------|
| `enabled`           | boolean      | `true`                                                                                                       | 是否启用该加载器        |
| `ignore-case`       | boolean      | `true`                                                                                                       | 是否忽略字典 key 的大小写 |
| `location-patterns` | List<String> | `["dict_i18n/dict_*.yml", "dict_i18n/dict_*.properties", "dict_i18n/dict.yml", "dict_i18n/dict.properties"]` | 翻译文件位置          |

---

### 3️⃣ `redis` — 基于 Redis 的加载器

| 配置项                       | 类型      | 默认值                                                                                                          | 说明                              |
|---------------------------|---------|--------------------------------------------------------------------------------------------------------------|---------------------------------|
| `enabled`                 | boolean | `true`                                                                                                       | 是否启用该加载器                        |
| `ignore-case`             | boolean | `true`                                                                                                       | 是否忽略字典 key 的大小写                 |
| `location-patterns`       | List    | `["dict_i18n/dict_*.yml", "dict_i18n/dict_*.properties", "dict_i18n/dict.yml", "dict_i18n/dict.properties"]` | 翻译文件位置                          |
| `key-prefix`              | string  | `dict_i18n`                                                                                                  | Redis 中使用的 key 前缀               |
| `preload`                 | object  | [preload](#redis-preload)                                                                                    | 预加载配置                           |
| `error-handling-strategy` | enum    | `FAIL`                                                                                                       | 异常处理策略：`FAIL`（报错）或 `IGNORE`（忽略） |

#### 🔄 Redis 预加载 preload

<a id="redis-preload"></a>

| 配置项            | 类型      | 默认值           | 说明                                   |
|----------------|---------|---------------|--------------------------------------|
| `enabled`      | boolean | `true`        | 启动时是否从资源文件预加载数据到 Redis               |
| `fail-fast`    | boolean | `true`        | 加载失败是否快速失败                           |
| `preload-mode` | enum    | `INCREMENTAL` | 预加载模式：`INCREMENTAL` 增量加载，或 `FULL` 全量 |

---

### 4️⃣ `sql` — 基于数据库的加载器

| 配置项                       | 类型           | 默认值                                                                                                          | 说明                       |
|---------------------------|--------------|--------------------------------------------------------------------------------------------------------------|--------------------------|
| `enabled`                 | boolean      | `true`                                                                                                       | 是否启用该加载器                 |
| `ignore-case`             | boolean      | `true`                                                                                                       | 是否忽略字典 key 的大小写          |
| `location-patterns`       | List<String> | `["dict_i18n/dict_*.yml", "dict_i18n/dict_*.properties", "dict_i18n/dict.yml", "dict_i18n/dict.properties"]` | 翻译文件位置                   |
| `preload`                 | object       | [preload](#sql-preload)                                                                                      | 预加载配置                    |
| `schema`                  | object       | [schema](#sql-schema)                                                                                        | 数据库模式配置                  |
| `cache`                   | object       | [cache](#sql-cache)                                                                                          | 缓存配置                     |
| `error-handling-strategy` | enum         | `FAIL`                                                                                                       | 异常处理策略：`FAIL` 或 `IGNORE` |

#### 🔄 数据库预加载 preload

<a id="sql-preload"></a>

| 配置项            | 类型      | 默认值           | 说明                                   |
|----------------|---------|---------------|--------------------------------------|
| `enabled`      | boolean | `true`        | 启动时是否从资源文件加载数据到数据库                   |
| `fail-fast`    | boolean | `true`        | 加载失败是否快速失败                           |
| `preload-mode` | enum    | `INCREMENTAL` | 预加载模式：`INCREMENTAL` 增量加载，或 `FULL` 全量 |

#### 🗃️ schema 初始化配置（自动建表）

<a id="sql-schema"></a>

| 配置项       | 类型      | 默认值    | 说明             |
|-----------|---------|--------|----------------|
| `enabled` | boolean | `true` | 是否启用自动建表和建索引功能 |

#### 🧠 缓存配置

<a id="sql-cache"></a>

| 配置项                          | 类型      | 默认值               | 说明               |
|------------------------------|---------|-------------------|------------------|
| `enabled`                    | boolean | `true`(自1.0.2版本起) | 是否启用 SQL 加载器本地缓存 |
| `maximum-size`               | int     | `1000`            | 最大缓存条目数          |
| `expire-after-write-seconds` | int     | `300`             | 缓存写入后的过期时间（单位：秒） |

---

## 🚀 `starter` 启动器相关配置

---

### 🔎 `scan-packages` — 扫描包路径

**类型**：`List<String>`
**说明**：配置需要扫描的包路径，自动发现实现了 `Dict` 接口的字典类。

---

### 🌐 `endpoint` — 字典管理接口配置

| 配置项       | 类型      | 默认值    | 说明                     |
|-----------|---------|--------|------------------------|
| `enabled` | boolean | `true` | 是否启用内置管理接口（Servlet 实现） |

#### 子项：`dict-items` 接口

| 配置项       | 类型      | 默认值                     | 说明         |
|-----------|---------|-------------------------|------------|
| `enabled` | boolean | `true`                  | 是否启用字典条目接口 |
| `path`    | string  | `/dict-i18n/dict-items` | 接口访问路径     |

#### 子项：`dict-names` 接口

| 配置项       | 类型      | 默认值                     | 说明         |
|-----------|---------|-------------------------|------------|
| `enabled` | boolean | `true`                  | 是否启用字典名称接口 |
| `path`    | string  | `/dict-i18n/dict-names` | 接口访问路径     |

---

### ✨ `enhancer` — 响应增强配置

用于自动注入字典描述到 HTTP 响应体。

| 配置项                   | 类型           | 说明                                |
|-----------------------|--------------|-----------------------------------|
| `enabled`             | boolean      | 是否启用全局响应增强功能                      |
| `include-packages`    | List<String> | 只增强返回类型在这些包下的类，未配置时默认扫描 Spring 主包 |
| `exclude-annotations` | List<String> | 被这些注解标记的类或方法将跳过增强，填写注解的全类名        |

---

### ✅ `check.unique-dict-name` — 字典名唯一性检查

| 配置项       | 类型      | 默认值    | 说明               |
|-----------|---------|--------|------------------|
| `enabled` | boolean | `true` | 启动时是否检查所有字典名称唯一性 |

## 📋 完整清单

```yaml
dict-i18n:
  #  指定Loader名称的优先级，例如：["declared", "file", "redis", "sql"]
  loader-order:
    - redis
    - sql
    - file
    - declared
  # 查找字段时的最大嵌套深度
  max-nesting-depth: 10
  # 是否在描述为空时返回 dictKey
  return-key-if-empty: true
  # 当未找到翻译时使用的默认语言
  default-lang: zh
  loader:
    declared:
      # 是否启用已声明的字典加载器
      enabled: true
      # 是否忽略字典大小写
      ignore-case: true
    file:
      # 是否启用文件字典加载器
      enabled: true
      # 是否忽略字典大小写
      ignore-case: true
    redis:
      # 是否启用redis字典加载器
      enabled: true
      # 是否忽略字典大小写
      ignore-case: true
      # 字典缓存中键的前缀
      key-prefix: 'dict_i18n'
      # 当发生意外异常时的异常处理策略
      error-handling-strategy: FAIL
      preload:
        # 是否在启动时从资源文件加载字典数据到 Redis 中
        enabled: false
        # 是否在将字典数据加载到 Redis 时快速失败
        fail-fast: true
        # 预加载到 Redis 的加载模式
        preload-mode: INCREMENTAL
    sql:
      # 是否启用sql字典加载器
      enabled: true
      # 是否忽略字典大小写
      ignore-case: true
      # 异常处理策略当发生意外异常时
      error-handling-strategy: FAIL
      schema:
        # 是否启用模式初始化（创建表 + 创建索引）
        enabled: false
      preload:
        # 是否在启动时将资源文件中的词典数据加载到数据库中
        enabled: false
        # 是否在将字典数据加载到数据库时快速失败
        fail-fast: true
        # 预加载到数据库的加载模式
        preload-mode: INCREMENTAL
      cache:
        # 是否启用sql字典加载器缓存
        enabled: true
        # 最大缓存项数量
        maximum-size: 1000
        # 缓存过期时间（单位：秒）
        expire-after-write-seconds: 300
  starter:
    # 要扫描的包路径列表，以查找 {@link cn.silwings.dicti18n.dict.Dict} 实现类
    scan-packages:
    endpoint:
      # 是否启用内置web端点
      enabled: true
      dict-items:
        # 是否启用字典项端点
        enabled: true
        # 字典项端点的路径
        path: /dict-i18n/dict-items
      dict-names:
        # 是否启用字典项端点
        enabled: true
        # 字典名称端点的路径
        path: /dict-i18n/dict-names
    enhancer:
      # 是否启用全局响应增强
      enabled: true
      # 包名列表。仅包含这些包中返回类型的响应将被增强。若未指定，则默认为Spring组件扫描的基础包
      include-packages:
        - cn.silwings.dicti18n.demo
        - org.springframework.http
      # 注解的完全限定名称。如果类或方法使用了这些注解中的任意一个，它将被排除在增强处理之外
      exclude-annotations:
    check:
      unique-dict-name:
        # 启动时检查字典名称是否唯一
        enabled: true
```

| [< 加载器说明](../loader/加载器说明.md) | [常见问题 >](../faq/常见问题.md) |
|:------------------------------|-------------------------:|