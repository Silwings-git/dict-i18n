# ⚙️ `dict-i18n` 配置说明文档

该文档详细介绍了 `dict-i18n` 所有可配置的 YAML 配置项，用于集成到 Spring Boot 项目的 `application.yml` 或
`application.properties` 中。

---

## 📌 顶层配置结构

```yaml
dict-i18n:
  loader-order:               # 加载器优先级顺序
  max-nesting-depth:          # 最大嵌套解析深度
  return-key-if-empty:        # 描述缺失时是否返回字典 key
  default-lang:               # 默认语言
  loader:                     # 各加载器配置
  starter:                    # 启动相关配置
```

---

## 🔄 `loader-order` — 加载器优先级

**类型**：`List<String>`
**说明**：指定字典加载器的加载顺序，先加载的优先级高。
**示例**：

```yaml
loader-order:
  - redis
  - sql
  - file
  - declared
```

---

## 🔍 `max-nesting-depth` — 最大嵌套解析深度

**类型**：`int`
**默认值**：`10`
**说明**：解析对象中嵌套字典字段的最大递归层级，防止死循环。

---

## 🔁 `return-key-if-empty` — 返回字典 key（当描述为空）

**类型**：`boolean`
**默认值**：`true`
**说明**：如果找不到翻译描述，是否返回字典 key 本身作为兜底内容。

---

## 🌐 `default-lang` — 默认语言

**类型**：`String`
**默认值**：`""`
**说明**：当请求语言找不到对应翻译时使用的默认语言。默认值对应的文件为`dict.yml`。

---

## 🧩 `loader` — 各加载器配置

支持的加载器包括：`declared`（代码声明）、`file`（文件）、`sql`（数据库）、`redis`（缓存）

---

### 1️⃣ `declared` — 基于代码声明的加载器

| 配置项             | 类型           | 默认值    | 说明              |
|-----------------|--------------|--------|-----------------|
| `enabled`       | boolean      | `true` | 是否启用该加载器        |
| `ignore-case`   | boolean      | `true` | 是否忽略字典 key 的大小写 |
| `scan-packages` | List<String> | `[]`   | 扫描基础路径          |

---

### 2️⃣ `file` — 基于资源文件的加载器

| 配置项                 | 类型           | 默认值                                                                                                          | 说明              |
|---------------------|--------------|--------------------------------------------------------------------------------------------------------------|-----------------|
| `enabled`           | boolean      | `true`                                                                                                       | 是否启用该加载器        |
| `ignore-case`       | boolean      | `true`                                                                                                       | 是否忽略字典 key 的大小写 |
| `location-patterns` | List<String> | `["dict_i18n/dict_*.yml", "dict_i18n/dict_*.properties", "dict_i18n/dict.yml", "dict_i18n/dict.properties"]` | 翻译文件位置          |

---

### 3️⃣ `redis` — 基于 Redis 的加载器

| 配置项                       | 类型      | 默认值                                                                                                          | 说明                              |
|---------------------------|---------|--------------------------------------------------------------------------------------------------------------|---------------------------------|
| `enabled`                 | boolean | `true`                                                                                                       | 是否启用该加载器                        |
| `ignore-case`             | boolean | `true`                                                                                                       | 是否忽略字典 key 的大小写                 |
| `location-patterns`       | List    | `["dict_i18n/dict_*.yml", "dict_i18n/dict_*.properties", "dict_i18n/dict.yml", "dict_i18n/dict.properties"]` | 翻译文件位置                          |
| `key-prefix`              | string  | `dict_i18n`                                                                                                  | Redis 中使用的 key 前缀               |
| `preload`                 | object  | [preload](#redis-preload)                                                                                    | 预加载配置                           |
| `error-handling-strategy` | enum    | `FAIL`                                                                                                       | 异常处理策略：`FAIL`（报错）或 `IGNORE`（忽略） |

#### 🔄 Redis 预加载 preload

<a id="redis-preload"></a>

| 配置项            | 类型      | 默认值           | 说明                                   |
|----------------|---------|---------------|--------------------------------------|
| `enabled`      | boolean | `false`       | 启动时是否从资源文件预加载数据到 Redis               |
| `fail-fast`    | boolean | `true`        | 加载失败是否快速失败                           |
| `preload-mode` | enum    | `INCREMENTAL` | 预加载模式：`INCREMENTAL` 增量加载，或 `FULL` 全量 |

---

### 4️⃣ `sql` — 基于数据库的加载器

| 配置项                       | 类型           | 默认值                                                                                                          | 说明                       |
|---------------------------|--------------|--------------------------------------------------------------------------------------------------------------|--------------------------|
| `enabled`                 | boolean      | `true`                                                                                                       | 是否启用该加载器                 |
| `ignore-case`             | boolean      | `true`                                                                                                       | 是否忽略字典 key 的大小写          |
| `location-patterns`       | List<String> | `["dict_i18n/dict_*.yml", "dict_i18n/dict_*.properties", "dict_i18n/dict.yml", "dict_i18n/dict.properties"]` | 翻译文件位置                   |
| `preload`                 | object       | [preload](#sql-preload)                                                                                      | 预加载配置                    |
| `schema`                  | object       | [schema](#sql-schema)                                                                                        | 数据库模式配置                  |
| `cache`                   | object       | [cache](#sql-cache)                                                                                          | 缓存配置                     |
| `error-handling-strategy` | enum         | `FAIL`                                                                                                       | 异常处理策略：`FAIL` 或 `IGNORE` |

#### 🔄 数据库预加载 preload

<a id="sql-preload"></a>

| 配置项            | 类型      | 默认值           | 说明                                   |
|----------------|---------|---------------|--------------------------------------|
| `enabled`      | boolean | `false`       | 启动时是否从资源文件加载数据到数据库                   |
| `fail-fast`    | boolean | `true`        | 加载失败是否快速失败                           |
| `preload-mode` | enum    | `INCREMENTAL` | 预加载模式：`INCREMENTAL` 增量加载，或 `FULL` 全量 |

#### 🗃️ schema 初始化配置（自动建表）

<a id="sql-schema"></a>

| 配置项       | 类型      | 默认值     | 说明             |
|-----------|---------|---------|----------------|
| `enabled` | boolean | `false` | 是否启用自动建表和建索引功能 |

#### 缓存配置

<a id="sql-cache"></a>

| 配置项                          | 类型      | 默认值     | 说明               |
|------------------------------|---------|---------|------------------|
| `enabled`                    | boolean | `false` | 是否启用 SQL 加载器本地缓存 |
| `maximum-size`               | int     | `1000`  | 最大缓存条目数          |
| `expire-after-write-seconds` | int     | `300`   | 缓存写入后的过期时间（单位：秒） |

---

## 🚀 `starter` 启动器相关配置

---

### 🔎 `scan-packages` — 扫描包路径

**类型**：`List<String>`
**说明**：配置需要扫描的包路径，自动发现实现了 `Dict` 接口的字典类。

---

### 🌐 `endpoint` — 字典管理接口配置

| 配置项       | 类型      | 默认值    | 说明                     |
|-----------|---------|--------|------------------------|
| `enabled` | boolean | `true` | 是否启用内置管理接口（Servlet 实现） |

#### 子项：`dict-items` 接口

| 配置项       | 类型      | 默认值                     | 说明         |
|-----------|---------|-------------------------|------------|
| `enabled` | boolean | `true`                  | 是否启用字典条目接口 |
| `path`    | string  | `/dict-i18n/dict-items` | 接口访问路径     |

#### 子项：`dict-names` 接口

| 配置项       | 类型      | 默认值                     | 说明         |
|-----------|---------|-------------------------|------------|
| `enabled` | boolean | `true`                  | 是否启用字典名称接口 |
| `path`    | string  | `/dict-i18n/dict-names` | 接口访问路径     |

---

### ✨ `enhancer` — 响应增强配置

用于自动注入字典描述到 HTTP 响应体。

| 配置项                   | 类型           | 说明                                |
|-----------------------|--------------|-----------------------------------|
| `enabled`             | boolean      | 是否启用全局响应增强功能                      |
| `include-packages`    | List<String> | 只增强返回类型在这些包下的类，未配置时默认扫描 Spring 主包 |
| `exclude-annotations` | List<String> | 被这些注解标记的类或方法将跳过增强，填写注解的全类名        |

---

### ✅ `check.unique-dict-name` — 字典名唯一性检查

| 配置项       | 类型      | 默认值    | 说明               |
|-----------|---------|--------|------------------|
| `enabled` | boolean | `true` | 启动时是否检查所有字典名称唯一性 |
