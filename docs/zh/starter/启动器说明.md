# ğŸ”Œ Dict-I18n å¯åŠ¨å™¨(Spring Boot Starter)è¯´æ˜

## ğŸ“˜ æ¦‚è¿°

`dict-i18n` æä¾›äº†ä¸“é—¨çš„ Spring Boot Starterï¼Œé€šè¿‡è‡ªåŠ¨é…ç½®æœºåˆ¶ç®€åŒ–æ¡†æ¶åœ¨ Spring Boot åº”ç”¨ä¸­çš„é›†æˆã€‚æ ¸å¿ƒå›´ç»•
`DictI18nAutoConfiguration` ç±»å®ç°ï¼Œå½“å¯åŠ¨å™¨è¢«å¼•å…¥åº”ç”¨æ—¶ï¼Œä¼šè‡ªåŠ¨é…ç½®æ‰€æœ‰å¿…è¦çš„ Beanï¼Œæ— éœ€æ‰‹åŠ¨ç¼–å†™ç¹ççš„åˆå§‹åŒ–ä»£ç ã€‚

è¯¥ Starter å®ç°äº†åŠ è½½å™¨çš„è‡ªåŠ¨æ³¨å†Œã€å­—å…¸æ‰«æã€REST ç«¯ç‚¹æš´éœ²ç­‰æ ¸å¿ƒåŠŸèƒ½ï¼Œå¹¶æ”¯æŒé€šè¿‡é…ç½®çµæ´»è°ƒæ•´è¡Œä¸ºï¼Œå®Œå…¨é€‚é… Spring Boot çš„"
çº¦å®šå¤§äºé…ç½®"ç†å¿µã€‚

---

## ğŸ”§ è‡ªåŠ¨é…ç½®æ¶æ„

### æ ¸å¿ƒè‡ªåŠ¨é…ç½®ç±»

è‡ªåŠ¨é…ç½®çš„æ ¸å¿ƒæ˜¯ `DictI18nAutoConfiguration`ï¼Œå®ƒè´Ÿè´£ï¼š

- æ ¹æ®é…ç½®æ¡ä»¶æ³¨å†Œå…³é”® Bean
- åè°ƒåŠ è½½å™¨æ’åºã€å­—å…¸æ‰«æç­‰ç»„ä»¶çš„åˆå§‹åŒ–
- æ³¨å†Œ REST ç«¯ç‚¹å¤„ç†å™¨
- é›†æˆè¯­è¨€æä¾›å™¨ç­‰æ‰©å±•ç‚¹

### è‡ªåŠ¨é…ç½® Bean ä¾èµ–å…³ç³»

Starter é€šè¿‡æ¡ä»¶æ³¨è§£ï¼ˆ`@Conditional`ï¼‰æ ¹æ®é…ç½®åŠ¨æ€æ³¨å†Œ Beanï¼Œç¡®ä¿ç»„ä»¶æŒ‰éœ€åŠ è½½ã€‚æ ¸å¿ƒ Bean åŠå…¶ä¾èµ–å…³ç³»å¦‚ä¸‹ï¼š

| Bean åç§°                    | ç”Ÿæ•ˆæ¡ä»¶                                                    | åŠŸèƒ½ç”¨é€”                 |
|----------------------------|---------------------------------------------------------|----------------------|
| `DictLoaderConfigSorter`   | `dict-i18n.loader-order[0]` å­˜åœ¨                          | æ ¹æ®é…ç½®å¯¹åŠ è½½å™¨è¿›è¡Œä¼˜å…ˆçº§æ’åº      |
| `SpringDictLoaderSorter`   | ä¸å­˜åœ¨ `DictLoaderSorter` ç±»å‹ Bean                          | æä¾›é»˜è®¤çš„åŠ è½½å™¨æ’åºå®ç°         |
| `UniqueDictNameChecker`    | `dict-i18n.starter.check.unique-dict-name.enabled=true` | éªŒè¯å­—å…¸åç§°çš„å”¯ä¸€æ€§ï¼Œé˜²æ­¢å†²çª      |
| `DictMapHolder`            | `dict-i18n.starter.endpoint.enabled=true`               | ä½œä¸ºå­—å…¸æšä¸¾çš„ä¸­å¤®æ³¨å†Œè¡¨ï¼Œæ”¯æŒç«¯ç‚¹æŸ¥è¯¢  |
| `DictItemsEndpointHandler` | `dict-i18n.starter.endpoint.dict-items.enabled=true`    | å¤„ç†å­—å…¸é¡¹æŸ¥è¯¢çš„ REST ç«¯ç‚¹å¤„ç†å™¨  |
| `DictNamesEndpointHandler` | `dict-i18n.starter.endpoint.dict-names.enabled=true`    | å¤„ç†å­—å…¸åç§°æŸ¥è¯¢çš„ REST ç«¯ç‚¹å¤„ç†å™¨ |

---

## âš™ï¸ é…ç½®å±æ€§

Starter æä¾›äº†ä¸°å¯Œçš„é…ç½®é¡¹ï¼Œæ‰€æœ‰å±æ€§å‡ä»¥ `dict-i18n.starter` ä¸ºå‰ç¼€ï¼Œæ”¯æŒåœ¨ `application.yml` æˆ– `application.properties`
ä¸­é…ç½®ã€‚

### æ ¸å¿ƒé…ç½®é¡¹

```yaml
dict-i18n:
  starter:
    scan-packages: [ ]  # æ‰«æ Dict å®ç°ç±»çš„åŒ…è·¯å¾„
    check:
      unique-dict-name:
        enabled: true  # æ˜¯å¦å¯ç”¨å­—å…¸åç§°å”¯ä¸€æ€§æ ¡éªŒ
    endpoint:
      enabled: true  # æ˜¯å¦å¯ç”¨ REST ç«¯ç‚¹
      dict-items:
        enabled: true  # æ˜¯å¦å¯ç”¨å­—å…¸é¡¹ç«¯ç‚¹
        path: /dict-i18n/dict-items  # å­—å…¸é¡¹ç«¯ç‚¹è·¯å¾„
      dict-names:
        enabled: true  # æ˜¯å¦å¯ç”¨å­—å…¸åç§°ç«¯ç‚¹
        path: /dict-i18n/dict-names  # å­—å…¸åç§°ç«¯ç‚¹è·¯å¾„
    enhancer:
      enabled: true  # æ˜¯å¦å¯ç”¨å“åº”å¢å¼º
      include-packages: [ ]  # éœ€è¦å¢å¼ºçš„åŒ…è·¯å¾„
      exclude-annotations: [ ]  # æ’é™¤å¢å¼ºçš„æ³¨è§£
```

### é…ç½®é¡¹è¯¦æƒ…

| å±æ€§è·¯å¾„                             | ç±»å‹             | é»˜è®¤å€¼                     | æè¿°è¯´æ˜                    |
|----------------------------------|----------------|-------------------------|-------------------------|
| `scan-packages`                  | `List<String>` | ç©ºåˆ—è¡¨                     | æŒ‡å®šéœ€è¦æ‰«æ `Dict` æ¥å£å®ç°ç±»çš„åŒ…è·¯å¾„ |
| `check.unique-dict-name.enabled` | `boolean`      | `true`                  | æ˜¯å¦åœ¨å¯åŠ¨æ—¶æ ¡éªŒæ‰€æœ‰å­—å…¸åç§°çš„å”¯ä¸€æ€§      |
| `endpoint.enabled`               | `boolean`      | `true`                  | æ˜¯å¦å¯ç”¨ REST ç«¯ç‚¹åŠŸèƒ½          |
| `endpoint.dict-names.enabled`    | `boolean`      | `true`                  | æ˜¯å¦å¯ç”¨å­—å…¸åç§°æŸ¥è¯¢ç«¯ç‚¹            |
| `endpoint.dict-names.path`       | `String`       | `/dict-i18n/dict-names` | å­—å…¸åç§°ç«¯ç‚¹çš„è®¿é—®è·¯å¾„             |
| `endpoint.dict-items.enabled`    | `boolean`      | `true`                  | æ˜¯å¦å¯ç”¨å­—å…¸é¡¹æŸ¥è¯¢ç«¯ç‚¹             |
| `endpoint.dict-items.path`       | `String`       | `/dict-i18n/dict-items` | å­—å…¸é¡¹ç«¯ç‚¹çš„è®¿é—®è·¯å¾„              |
| `enhancer.enabled`               | `boolean`      | `true`                  | æ˜¯å¦å¯ç”¨å“åº”å¢å¼ºï¼ˆè‡ªåŠ¨æ›¿æ¢å­—å…¸ç ä¸ºæè¿°ï¼‰    |
| `enhancer.include-packages`      | `List<String>` | []                      | éœ€è¦è¿›è¡Œå“åº”å¢å¼ºçš„åŒ…è·¯å¾„ï¼ˆä¸ºç©ºæ—¶å…¨éƒ¨ç”Ÿæ•ˆï¼‰   |
| `enhancer.exclude-annotations`   | `List<String>` | []                      | æ’é™¤å“åº”å¢å¼ºçš„æ³¨è§£ï¼ˆæ ‡æ³¨è¯¥æ³¨è§£çš„ç±»ä¸å¢å¼ºï¼‰   |

---

## ğŸŒ REST ç«¯ç‚¹

Starter å†…ç½®ä¸¤ä¸ª REST ç«¯ç‚¹ï¼Œç”¨äºä»¥ç¼–ç¨‹æ–¹å¼æŸ¥è¯¢å­—å…¸æ•°æ®ï¼Œæ–¹ä¾¿å‰ç«¯æˆ–å…¶ä»–æœåŠ¡è·å–å›½é™…åŒ–ä¿¡æ¯ã€‚

æ³¨æ„: REST ç«¯ç‚¹åªå¤„ç†æšä¸¾ç±»å‹çš„Dictå®ç°!!!

### å­—å…¸åç§°ç«¯ç‚¹ï¼ˆDict Names Endpointï¼‰

#### åŠŸèƒ½

æŸ¥è¯¢ç³»ç»Ÿä¸­æ‰€æœ‰å¯ç”¨çš„å­—å…¸åç§°ã€‚

#### å“åº”æ ¼å¼

```json
[
  "order_status",
  "product_type"
]
```

### å­—å…¸é¡¹ç«¯ç‚¹ï¼ˆDict Items Endpointï¼‰

è·¯å¾„: `/dict-i18n/dict-items`

#### åŠŸèƒ½

æŸ¥è¯¢æŒ‡å®šå­—å…¸çš„æ‰€æœ‰é¡¹åŠå…¶ç¿»è¯‘æ–‡æœ¬()ã€‚

#### è¯·æ±‚å‚æ•°

- `dictNames`ï¼šå¿…å¡«ï¼Œä»¥é€—å·åˆ†éš”çš„å­—å…¸åç§°åˆ—è¡¨ï¼ˆå¦‚ `order_status,product_type`ï¼‰
- `language`ï¼šå¯é€‰ï¼Œè¯­è¨€ä»£ç ï¼ˆå¦‚ `zh-cn`ã€`en`ï¼‰ï¼Œé»˜è®¤ä½¿ç”¨å½“å‰ä¸Šä¸‹æ–‡è¯­è¨€

#### å“åº”æ ¼å¼

```json
{
  "items": {
    "order_status": [
      {
        "code": "pending",
        "desc": "å¾…å¤„ç†"
      },
      {
        "code": "completed",
        "desc": "å·²å®Œæˆ"
      }
    ],
    "product_type": [
      {
        "code": "physical",
        "desc": "å®ç‰©å•†å“"
      },
      {
        "code": "digital",
        "desc": "æ•°å­—å•†å“"
      }
    ]
  }
}
```

### ç«¯ç‚¹æ³¨å†Œæœºåˆ¶

ç«¯ç‚¹é€šè¿‡ `SimpleUrlHandlerMapping` æ³¨å†Œä¸º Spring MVC å¤„ç†å™¨ï¼Œæ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š

```java
private HandlerMapping buildHandlerMapping(final String path, final HttpRequestHandler handler) {
    final Map<String, HttpRequestHandler> urlMap = new HashMap<>();
    urlMap.put(path, handler);
    final SimpleUrlHandlerMapping mapping = new SimpleUrlHandlerMapping();
    mapping.setUrlMap(urlMap);
    mapping.setOrder(0);
    return mapping;
}
```

è¯¥æœºåˆ¶ç¡®ä¿ç«¯ç‚¹å¯ä»¥ç›´æ¥å“åº” HTTP è¯·æ±‚ï¼Œæ— éœ€é¢å¤–çš„æ§åˆ¶å™¨é…ç½®ã€‚

---

## ğŸ§© æ ¸å¿ƒé›†æˆç»„ä»¶

### DictMapHolder

#### åŠŸèƒ½

ä½œä¸ºå­—å…¸æšä¸¾çš„ä¸­å¤®æ³¨å†Œè¡¨ï¼Œåœ¨åº”ç”¨å¯åŠ¨æ—¶æ”¶é›†æ‰€æœ‰ `Dict` æ¥å£æšä¸¾å®ç°ç±»ï¼Œå¹¶æä¾›æŸ¥è¯¢èƒ½åŠ›ã€‚

#### æ ¸å¿ƒèŒè´£

- æ‰«ææŒ‡å®šåŒ…è·¯å¾„ä¸‹çš„ `Dict` æšä¸¾å®ç°ç±»
- ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„ `ConcurrentHashMap<String, Dict[]>` å­˜å‚¨å­—å…¸åç§°ä¸æšä¸¾å¸¸é‡çš„æ˜ å°„
- ä¸º REST ç«¯ç‚¹æä¾›å­—å…¸æ•°æ®æŸ¥è¯¢æ¥å£
- å®ç° `ApplicationRunner` æ¥å£ï¼Œåœ¨ Spring ä¸Šä¸‹æ–‡åŠ è½½å®Œæˆåæ‰§è¡Œåˆå§‹åŒ–

#### åˆå§‹åŒ–æµç¨‹

1. æ ¹æ®é…ç½®ç¡®å®šéœ€è¦æ‰«æçš„åŒ…è·¯å¾„ï¼ˆä¼˜å…ˆä½¿ç”¨ `scan-packages` é…ç½®ï¼Œé»˜è®¤ä½¿ç”¨è‡ªåŠ¨é…ç½®åŒ…ï¼‰
2. é€šè¿‡ `DictScanner` æŸ¥æ‰¾æ‰€æœ‰å®ç° `Dict` æ¥å£çš„æšä¸¾ç±»
3. å°†æšä¸¾å¸¸é‡æŒ‰ `dictName()` æ–¹æ³•è¿”å›çš„åç§°æ³¨å†Œåˆ°æ˜ å°„è¡¨ä¸­

### UniqueDictNameChecker

#### åŠŸèƒ½

åœ¨åº”ç”¨å¯åŠ¨æ—¶æ ¡éªŒæ‰€æœ‰å­—å…¸åç§°çš„å”¯ä¸€æ€§ï¼Œé˜²æ­¢å¤šä¸ªæšä¸¾ä½¿ç”¨ç›¸åŒçš„å­—å…¸åç§°å¯¼è‡´è¿è¡Œæ—¶å†²çªã€‚

#### æ ¡éªŒé€»è¾‘

1. ä½¿ç”¨ `DictScanner` æ‰«ææ‰€æœ‰ `Dict` å®ç°ç±»
2. æ”¶é›†æ‰€æœ‰æšä¸¾å¸¸é‡çš„å­—å…¸åç§°
3. è‹¥å‘ç°é‡å¤åç§°ï¼Œç«‹å³æŠ›å‡ºå¼‚å¸¸ç»ˆæ­¢å¯åŠ¨ï¼ˆå¿«é€Ÿå¤±è´¥æœºåˆ¶ï¼‰

### è¯­è¨€æä¾›å™¨é›†æˆ

Starter æä¾›é»˜è®¤çš„ `DefaultLanguageProvider` å®ç°ï¼Œç”¨äºè·å–å½“å‰ä¸Šä¸‹æ–‡çš„è¯­è¨€ä¿¡æ¯ã€‚è‹¥éœ€è‡ªå®šä¹‰è¯­è¨€æ£€æµ‹é€»è¾‘ï¼ˆå¦‚ä»è¯·æ±‚å¤´ã€ç”¨æˆ·é…ç½®ä¸­è·å–è¯­è¨€ï¼‰ï¼Œå¯é€šè¿‡å®ç°
`LanguageProvider` æ¥å£å¹¶æ³¨å†Œä¸º Spring Bean è¦†ç›–é»˜è®¤å®ç°ï¼š

```java
@Bean
@ConditionalOnMissingBean(LanguageProvider.class)
public LanguageProvider defaultLangProvider() {
    return new DefaultLanguageProvider();
}
```

---

## ğŸ”„ å¯åŠ¨æµç¨‹

### åº”ç”¨å¯åŠ¨åºåˆ—

1. Spring Boot åº”ç”¨å¯åŠ¨ï¼Œè§¦å‘ `DictI18nAutoConfiguration` è‡ªåŠ¨é…ç½®
2. æ ¹æ®é…ç½®æ¡ä»¶æ³¨å†Œå¿…è¦çš„ Beanï¼ˆåŠ è½½å™¨æ’åºå™¨ã€ç«¯ç‚¹å¤„ç†å™¨ç­‰ï¼‰
3. `DictMapHolder` åœ¨ Spring ä¸Šä¸‹æ–‡åˆå§‹åŒ–å®Œæˆåæ‰§è¡Œæ‰«æ
4. æ‰«ææŒ‡å®šåŒ…è·¯å¾„ä¸‹çš„ `Dict` å®ç°ç±»å¹¶æ³¨å†Œåˆ°æ˜ å°„è¡¨
5. `UniqueDictNameChecker` æ‰§è¡Œå­—å…¸åç§°å”¯ä¸€æ€§æ ¡éªŒ
6. REST ç«¯ç‚¹é€šè¿‡ `SimpleUrlHandlerMapping` æ³¨å†Œåˆ° Spring MVC
7. åº”ç”¨å¯åŠ¨å®Œæˆï¼Œæ‰€æœ‰ç»„ä»¶å°±ç»ª

### æ‰«æåŒ…è·¯å¾„è§£æé€»è¾‘

æ¡†æ¶æŒ‰ä»¥ä¸‹ä¼˜å…ˆçº§ç¡®å®šæ‰«æåŒ…è·¯å¾„ï¼š

1. ä¼˜å…ˆä½¿ç”¨ `dict-i18n.starter.scan-packages` é…ç½®çš„åŒ…è·¯å¾„
2. è‹¥æœªé…ç½®ï¼Œé»˜è®¤ä½¿ç”¨ Spring Boot è‡ªåŠ¨é…ç½®çš„åŒ…è·¯å¾„ï¼ˆ`AutoConfigurationPackages.get(applicationContext)`ï¼‰

æ ¸å¿ƒä»£ç ï¼š

```java
private List<String> getScanPackages() {
    return this.dictI18nStarterProperties.getScanPackages().isEmpty()
            ? AutoConfigurationPackages.get(this.applicationContext)
            : this.dictI18nStarterProperties.getScanPackages();
}
```

---

## ğŸ›¡ï¸ é”™è¯¯å¤„ç†

Starter å†…ç½®å¤šé¡¹ä¿æŠ¤æœºåˆ¶ï¼Œç¡®ä¿ç³»ç»Ÿç¨³å®šè¿è¡Œï¼š

- **ç¼ºå¤±å­—å…¸å¤„ç†**ï¼šæŸ¥è¯¢ä¸å­˜åœ¨çš„å­—å…¸æ—¶è¿”å›ç©ºæ•°ç»„ï¼Œé¿å…è¿”å› `null` å¯¼è‡´ç©ºæŒ‡é’ˆå¼‚å¸¸
- **æ— æ•ˆé…ç½®å¤„ç†**ï¼šé€šè¿‡æ¡ä»¶ Bean æ³¨å†Œæœºåˆ¶ï¼Œè‡ªåŠ¨è·³è¿‡æ— æ•ˆé…ç½®çš„ç»„ä»¶
- **å¯åŠ¨å¤±è´¥å¤„ç†**ï¼š`UniqueDictNameChecker` åœ¨æ ¡éªŒåˆ°é‡å¤å­—å…¸åç§°æ—¶å¿«é€Ÿå¤±è´¥ï¼Œé¿å…è¿è¡Œæ—¶é”™è¯¯
- **ç«¯ç‚¹å®‰å…¨å¤„ç†**ï¼šç«¯ç‚¹é»˜è®¤å¯ç”¨ï¼Œå¯é€šè¿‡é…ç½®å…³é—­ï¼Œé˜²æ­¢æœªæˆæƒè®¿é—®

---

| [< å¿«é€Ÿå¼€å§‹](../guide/å¿«é€Ÿå¼€å§‹.md) | [åŠ è½½å™¨è¯´æ˜ >](../loader/åŠ è½½å™¨è¯´æ˜.md) |
|:---------------------------|------------------------------:|