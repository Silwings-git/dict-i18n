# 🧩 加载器（Loader）说明

## 📘 概述

`dict-i18n` 支持多种字典加载方式，开发者可根据系统需求选择合适的加载器。加载器用于从外部数据源（如文件、数据库、Redis
等）读取字典内容，并将其转换为标准格式供系统使用。每个加载器具备统一接口，并支持优先级控制、缓存机制及格式扩展。

系统内置多种加载器，并通过插件式架构允许自定义扩展，适用于不同体量与性能需求的国际化系统。

---

## 🧱 加载器结构与扩展机制

加载器通常包括以下几个核心环节：

1. **数据读取**：从指定来源读取字典数据（如文件、SQL、Redis 等）；
2. **数据解析**：解析原始数据格式为标准结构；
3. **缓存支持**（可选）：对加载结果进行本地缓存，减少重复加载；
4. **来源合并**：多个加载器支持合并覆盖，按配置顺序执行。

加载器遵循统一接口 `DictI18nLoader`，并可通过扩展组件增强能力（详见下文）。

---

## 📚 内置加载器一览

| 加载器名称         | 描述                             | 配置键        | 是否支持缓存 |
|---------------|--------------------------------|------------|--------|
| **文件加载器**     | 从 `yml` / `properties` 文件中加载字典 | `file`     | ✅      |
| **数据库加载器**    | 通过 SQL 查询加载字典                  | `sql`      | ✅      |
| **Redis 加载器** | 从 Redis 中加载字典项                 | `redis`    | ❌      |
| **声明式加载器**    | 在类中手动声明字典描述                    | `declared` | ❌      |

每个加载器都有对应配置项，并可按需开启、禁用或调整加载顺序。

---

## 📂 文件加载器（file）

* **功能**：从本地或者远程的 `YML` , `Properties` 文件中读取字典项。
* **使用场景**：适合中小项目、无需动态变更的环境。
* **默认支持格式**：`*.yml`, `*.properties`
* **缓存**: file加载器在项目启动时从文件加载全量数据并缓存在内存中,因此不支持自定义缓存策略。

### 🧩 文件格式扩展

文件加载器使用 `DictFileParser` 组件负责实际数据解析。系统默认支持 `yml` 与 `properties` 文件。

如需支持自定义文件格式（如 `json`, `xml`
等），可实现[DictFileParseStrategy](../../../dict-i18n-loader/dict-i18n-loader-core/src/main/java/cn/silwings/dicti18n/loader/parser/strategy/DictFileParseStrategy.java)
接口：

```java
public interface DictFileParseStrategy {

    boolean supports(Resource resource);

    List<DictInfo> parse(Resource resource);
}
```

并注入到Spring容器，系统将自动识别。

---

## 🧮 数据库加载器（sql）

* **功能**：从数据库表中查询字典数据。
* **使用场景**：适合字典内容由后台管理系统动态维护的中大型项目。

### 🧠 缓存机制

SQL 加载器默认开启缓存(自1.0.2版本起)，以提升性能，避免频繁数据库访问。

如需自定义缓存策略（如结合 Redis
本地缓存、刷新策略等），可实现[DictI18nLoaderCacheProvider](../../../dict-i18n-loader/dict-i18n-loader-core/src/main/java/cn/silwings/dicti18n/loader/cache/DictI18nLoaderCacheProvider.java)：

```java
public interface DictI18nLoaderCacheProvider {

    Optional<String> getDesc(String lang, String key, DictDescGetter descGetter);
}
```

注册该 Bean 后，系统将使用你的缓存提供器替代默认内存缓存。

---

## 🧰 Redis 加载器（redis）

* **功能**：从 Redis 中获取存储的字典数据。
* **使用场景**：适合分布式部署场景，或后台通过其他系统同步 Redis 中的字典内容。
* **缓存**: Redis 加载器不支持缓存。

---

## 🧾 声明式加载器（declared）

* **功能**
  ：通过实现[DeclaredDict](../../../dict-i18n-loader/dict-i18n-loader-declared/src/main/java/cn/silwings/dicti18n/loader/declared/dict/DeclaredDict.java)
  接口，或为Dict接口的实现类添加getDesc方法，使框架能够通过调用 Java 对象的方法获取描述信息。
* **使用场景**：适合静态字典，动态逻辑驱动的字典，或测试场景中快速配置字典数据。
* **注意事项**: declared加载器在读取字典描述时会忽略语言信息

示例：

```java
// todo 
```

---

## 🧩 加载器相关扩展组件总览

| 组件接口                          | 功能           | 应用加载器       |
|-------------------------------|--------------|-------------|
| `DictFileParser`              | 用于文件加载器的数据解析 | file        |
| `DictFileParseStrategy`       | 扩展支持更多文件格式   | file        |
| `DictI18nLoaderCacheProvider` | 自定义加载器缓存实现   | sql / redis |

---

## 🧠 加载器顺序控制（loader-order）

你可以通过配置项 `dict-i18n.loader-order` 显式声明加载器执行顺序，例如：

```yaml
dict-i18n:
  loader-order:
    - redis
    - sql
    - file
    - declared
```

靠前的加载器优先生效，后续加载器可以补充或覆盖前者的数据。

| [< 启动器说明](../starter/启动器说明.md) | [配置说明 >](../config/配置说明.md) |
|:-------------------------------|----------------------------:|